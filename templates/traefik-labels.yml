# Reusable templates for Traefik labels

# ============================================
# STANDARD LABELS
# ============================================
#
# Copy to your docker-compose.yml
# Replace {APP_NAME}, {SUBDOMAIN}, {PORT}

standard: |
  labels:
    - "traefik.enable=true"
    - "traefik.http.routers.{APP_NAME}.rule=Host(`{SUBDOMAIN}.${DOMAIN}`)"
    - "traefik.http.routers.{APP_NAME}.entrypoints=websecure"
    - "traefik.http.routers.{APP_NAME}.tls.certresolver=letsencrypt"
    - "traefik.http.services.{APP_NAME}.loadbalancer.server.port={PORT}"

# ============================================
# WITH AUTHENTIK (ForwardAuth)
# ============================================
#
# Protection via Authentik SSO

with_authentik: |
  labels:
    - "traefik.enable=true"
    - "traefik.http.routers.{APP_NAME}.rule=Host(`{SUBDOMAIN}.${DOMAIN}`)"
    - "traefik.http.routers.{APP_NAME}.entrypoints=websecure"
    - "traefik.http.routers.{APP_NAME}.tls.certresolver=letsencrypt"
    - "traefik.http.routers.{APP_NAME}.middlewares=authentik@docker"
    - "traefik.http.services.{APP_NAME}.loadbalancer.server.port={PORT}"

# ============================================
# WITH BASIC AUTH
# ============================================
#
# Simple password protection
# Generate hash: htpasswd -nb user password

with_basic_auth: |
  labels:
    - "traefik.enable=true"
    - "traefik.http.routers.{APP_NAME}.rule=Host(`{SUBDOMAIN}.${DOMAIN}`)"
    - "traefik.http.routers.{APP_NAME}.entrypoints=websecure"
    - "traefik.http.routers.{APP_NAME}.tls.certresolver=letsencrypt"
    - "traefik.http.routers.{APP_NAME}.middlewares={APP_NAME}-auth"
    - "traefik.http.middlewares.{APP_NAME}-auth.basicauth.users=${BASIC_AUTH_USERS}"
    - "traefik.http.services.{APP_NAME}.loadbalancer.server.port={PORT}"

# ============================================
# WITH WEBSOCKET
# ============================================
#
# For apps requiring WebSocket

with_websocket: |
  labels:
    - "traefik.enable=true"
    # HTTP standard
    - "traefik.http.routers.{APP_NAME}.rule=Host(`{SUBDOMAIN}.${DOMAIN}`)"
    - "traefik.http.routers.{APP_NAME}.entrypoints=websecure"
    - "traefik.http.routers.{APP_NAME}.tls.certresolver=letsencrypt"
    - "traefik.http.services.{APP_NAME}.loadbalancer.server.port={PORT}"
    # WebSocket
    - "traefik.http.routers.{APP_NAME}-ws.rule=Host(`{SUBDOMAIN}.${DOMAIN}`) && Path(`{WS_PATH}`)"
    - "traefik.http.routers.{APP_NAME}-ws.entrypoints=websecure"
    - "traefik.http.routers.{APP_NAME}-ws.tls.certresolver=letsencrypt"
    - "traefik.http.services.{APP_NAME}-ws.loadbalancer.server.port={WS_PORT}"

# ============================================
# REDIRECT HTTP â†’ HTTPS
# ============================================
#
# Global middleware (add to Traefik)

https_redirect: |
  labels:
    - "traefik.http.middlewares.https-redirect.redirectscheme.scheme=https"
    - "traefik.http.middlewares.https-redirect.redirectscheme.permanent=true"

# ============================================
# SECURITY HEADERS
# ============================================
#
# Recommended security headers

security_headers: |
  labels:
    - "traefik.http.middlewares.security-headers.headers.browserXssFilter=true"
    - "traefik.http.middlewares.security-headers.headers.contentTypeNosniff=true"
    - "traefik.http.middlewares.security-headers.headers.frameDeny=true"
    - "traefik.http.middlewares.security-headers.headers.stsIncludeSubdomains=true"
    - "traefik.http.middlewares.security-headers.headers.stsPreload=true"
    - "traefik.http.middlewares.security-headers.headers.stsSeconds=31536000"

# ============================================
# RATE LIMITING
# ============================================
#
# Limit the number of requests

rate_limit: |
  labels:
    - "traefik.http.middlewares.rate-limit.ratelimit.average=100"
    - "traefik.http.middlewares.rate-limit.ratelimit.burst=50"
    - "traefik.http.middlewares.rate-limit.ratelimit.period=1s"
