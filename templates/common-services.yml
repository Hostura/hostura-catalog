# Common reusable services
# Include in your docker-compose.yml via extends or as reference

# ============================================
# POSTGRESQL
# ============================================
postgres:
  image: postgres:16-alpine
  restart: unless-stopped
  environment:
    - POSTGRES_USER=${DB_USER:-app}
    - POSTGRES_PASSWORD=${DB_PASSWORD:?DB_PASSWORD is required}
    - POSTGRES_DB=${DB_NAME:-app}
  volumes:
    - postgres_data:/var/lib/postgresql/data
  healthcheck:
    test: ["CMD-SHELL", "pg_isready -U ${DB_USER:-app}"]
    interval: 10s
    timeout: 5s
    retries: 5

# ============================================
# MARIADB / MYSQL
# ============================================
mariadb:
  image: mariadb:11
  restart: unless-stopped
  environment:
    - MYSQL_ROOT_PASSWORD=${DB_ROOT_PASSWORD:?DB_ROOT_PASSWORD is required}
    - MYSQL_USER=${DB_USER:-app}
    - MYSQL_PASSWORD=${DB_PASSWORD:?DB_PASSWORD is required}
    - MYSQL_DATABASE=${DB_NAME:-app}
  volumes:
    - mariadb_data:/var/lib/mysql
  healthcheck:
    test: ["CMD", "healthcheck.sh", "--connect", "--innodb_initialized"]
    interval: 10s
    timeout: 5s
    retries: 5

# ============================================
# REDIS
# ============================================
redis:
  image: redis:7-alpine
  restart: unless-stopped
  command: redis-server --appendonly yes
  volumes:
    - redis_data:/data
  healthcheck:
    test: ["CMD", "redis-cli", "ping"]
    interval: 10s
    timeout: 5s
    retries: 5

# ============================================
# MONGODB
# ============================================
mongodb:
  image: mongo:7
  restart: unless-stopped
  environment:
    - MONGO_INITDB_ROOT_USERNAME=${MONGO_USER:-admin}
    - MONGO_INITDB_ROOT_PASSWORD=${MONGO_PASSWORD:?MONGO_PASSWORD is required}
  volumes:
    - mongodb_data:/data/db
  healthcheck:
    test: ["CMD", "mongosh", "--eval", "db.adminCommand('ping')"]
    interval: 10s
    timeout: 5s
    retries: 5

# ============================================
# VOLUMES TYPES
# ============================================
volumes:
  postgres_data:
  mariadb_data:
  redis_data:
  mongodb_data:
